# .github/workflows/gitleaks-test.yml
name: 'Gitleaks Personal Test'

on:
  workflow_dispatch:

jobs:
  gitleaks-scan:
    name: 'Run Gitleaks Scan'
    runs-on: ubuntu-latest

    steps:
      # Step 1: Checkout the repository with full history. No changes here.
      - name: 'Checkout Juice Shop Repo'
        uses: actions/checkout@v4
        with:
          repository: 'juice-shop/juice-shop'
          fetch-depth: 0

      # Step 2: Run the Gitleaks Action.
      # The invalid 'with:' block has been removed.
      # 'continue-on-error: true' is added at the step level, so the workflow
      # will proceed to the next step even if Gitleaks finds secrets and fails.
      - name: 'Run Gitleaks Scan'
        uses: gitleaks/gitleaks-action@v2
        continue-on-error: true

      # Step 3: Upload the Gitleaks report.
      # The path is updated to 'results.sarif', which is the default
      # report file generated by v2 of the Gitleaks action.
      - name: 'Upload Gitleaks Report'
        uses: actions/upload-artifact@v4
        with:
          name: gitleaks-report
          path: results.sarif
